root: "env"
schemas:
  env:
    type: "dict"
    props:
      name:
        non_empty: true
        type: "str"
      ctxs:
        required: true
        type: "list"
        elem_type: "str"
      migration:
        type: "str"
      container:
        type: "str"
      original_env_schema:
        type: "str"
      meta:
        schema: "meta"
      main:
        non_empty: true
        type: "map"
        elem_schema: "main"
      services:
        type: "map"
        elem_schema: "service"
      service_shared_group_params:
        type: "map"
        elem_schema: "shared_group_params"
      service_shared_params:
        type: "map"
        elem_type: "dict"
      service_group_params:
        type: "dict"
      nodes:
        type: "map"
        elem_schema: "node"
      node_shared_group_params:
        type: "map"
        elem_schema: "shared_group_params"
      node_shared_params:
        type: "map"
        elem_type: "dict"
      node_group_params:
        type: "dict"
      pods:
        type: "map"
        elem_schema: "pod"
      pod_shared_group_params:
        type: "map"
        elem_schema: "shared_group_params"
      pod_shared_params:
        type: "map"
        elem_type: "dict"
      pod_group_params:
        type: "dict"
      run_stages:
        type: "map"
        elem_schema: "run_stage_tasks"
      run_stage_tasks:
        type: "map"
        elem_schema: "run_stage_task"
      tasks:
        type: "map"
        elem_schema: "task"
      task_shared_group_params:
        type: "map"
        elem_schema: "shared_group_params"
      task_shared_params:
        type: "map"
        elem_type: "dict"
      task_group_params:
        type: "dict"
      contents:
        type: "map"
        elem_schema: "content"
      content_shared_group_params:
        type: "map"
        elem_schema: "shared_group_params"
      content_shared_params:
        type: "map"
        elem_type: "dict"
      content_group_params:
        type: "dict"
      repos:
        type: "map"
        non_empty: true
        elem_schema: "repo"
        elem_non_empty: true
      credentials:
        type: "dict"
  meta:
    type: "dict"
    props:
      lax:
        type: "bool"
      template_no_empty_lines:
        type: "bool"
  main:
    type: "dict"
    props:
      repo:
        non_empty: true
        type: "str"
      env_repos:
        type: "list"
        elem_schema: "repo_info"
      cfg:
        schema: "content"
      hosts:
        non_empty: true
        schema: "content"
      hooks:
        schema: "hooks"
      initial_services:
        type: "list"
        elem_schema: "main_service_info"
      nodes:
        type: "list"
        elem_schema: "main_node_info"
      final_services:
        type: "list"
        elem_schema: "main_service_info"
      run_stages:
        type: "list"
        elem_schema: "main_stage_info"
      extra_repos:
        type: "list"
        elem_schema: "main_extra_repo_info"
      original_env_schema:
        type: "str"
  repo_info:
    type: "dict"
    props:
      repo:
        non_empty: true
        type: "str"
      dir:
        non_empty: true
        type: "str"
  hooks:
    type: "dict"
    props:
      before_initial_services:
        type: "str"
      after_initial_services:
        type: "str"
      before_nodes:
        type: "str"
      after_nodes:
        type: "str"
      before_wait_nodes:
        type: "str"
      after_wait_nodes:
        type: "str"
      before_prepare_nodes:
        type: "str"
      after_prepare_nodes:
        type: "str"
      before_prepare_pods:
        type: "str"
      after_prepare_pods:
        type: "str"
      before_cron:
        type: "str"
      after_cron:
        type: "str"
      before_final_services:
        type: "str"
      after_final_services:
        type: "str"
      before_delete_tmp:
        type: "str"
      after_delete_tmp:
        type: "str"
      before_delete_main:
        type: "str"
      after_delete_main:
        type: "str"
  main_service_info:
    type: "simple_dict"
    alternative_type: "str"
    props:
      name:
        non_empty: true
        type: "str"
      key:
        type: "str"
      single:
        type: "bool"
      absent:
        type: "bool"
      tmp:
        type: "bool"
      can_destroy:
        type: "bool"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  main_node_info:
    type: "simple_dict"
    alternative_type: "str"
    props:
      name:
        non_empty: true
        type: "str"
      key:
        type: "str"
      local:
        type: "bool"
      local_host_test:
        type: "bool"
      local_host_test_error:
        type: "str"
        choices: ["timeout", "msg"]
      external:
        type: "bool"
      hostname:
        type: "str"
      amount:
        type: "int"
      max_amount:
        type: "int"
      transfer:
        type: "list"
        elem_schema: "transfer_content"
      pods:
        type: "map"
        elem_schema: "main_pod_params_info"
      dependencies:
        type: "list"
        elem_type: "unknown"
      absent:
        type: "bool"
      tmp:
        type: "bool"
      can_destroy:
        type: "bool"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  main_stage_info:
    type: "simple_dict"
    alternative_type: "str"
    props:
      tasks:
        schema: "run_stage_tasks"
        required: true
  main_extra_repo_info:
    type: "dict"
    props:
      repo:
        non_empty: true
        type: "str"
      dir:
        non_empty: true
        type: "str"
      transfer:
        type: "list"
        elem_schema: "transfer_content"
      links:
        type: "list"
        elem_schema: "main_extra_repo_link"
  main_pod_params_info:
    type: "dict"
    props:
      transfer:
        type: "list"
        elem_schema: "transfer_content"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  main_extra_repo_link:
    type: "dict"
    props:
      repo:
        type: "str"
      src:
        required: true
        type: "str"
      dest:
        non_empty: true
        type: "str"
  transfer_content:
    type: "dict"
    props:
      src:
        non_empty: true
        schema: "content"
      dest:
        non_empty: true
        type: "str"
      mode:
        type: "int"
      when:
        type: "bool"
  service:
    type: "dict"
    props:
      list:
        type: "bool"
      services:
        type: "list"
        elem_schema: "service_info"
      base_dir:
        type: "str"
      task:
        type: "str"
      namespace:
        type: "str"
      schema:
        type: "str"
      credentials:
        type: "map"
        elem_type: "str"
      contents:
        type: "map"
        elem_schema: "content"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  service_info:
    type: "simple_dict"
    alternative_type: "str"
    props:
      name:
        non_empty: true
        type: "str"
      key:
        type: "str"
      single:
        type: "bool"
      absent:
        type: "bool"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  node:
    type: "dict"
    props:
      service:
        type: "str"
      dns_service:
        type: "str"
      base_dir:
        type: "str"
      node_dir:
        type: "str"
      tmp_dir:
        type: "str"
      transfer:
        type: "list"
        elem_schema: "transfer_content"
      pods:
        type: "list"
        elem_schema: "node_pod_info"
      credential:
        type: "str"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  node_pod_info:
    type: "simple_dict"
    alternative_type: "str"
    props:
      name:
        non_empty: true
        type: "str"
      key:
        type: "str"
      transfer:
        type: "list"
        elem_schema: "transfer_content"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  pod:
    type: "dict"
    props:
      repo:
        type: "str"
        non_empty: true
      env_repos:
        type: "list"
        elem_schema: "repo_info"
      base_dir:
        type: "str"
      data_dir:
        type: "str"
      tmp_dir:
        type: "str"
      ctx:
        type: "str"
      schema:
        type: "str"
      root:
        type: "bool"
      flat:
        type: "bool"
      fast_prepare:
        type: "bool"
      skip_unchanged:
        type: "bool"
      transfer:
        type: "list"
        elem_schema: "transfer_content"
      credentials:
        type: "map"
        elem_type: "str"
      contents:
        type: "map"
        elem_schema: "content"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  run_stage_tasks:
    type: "list"
    elem_type: "simple_dict"
    elem_main_schema: "run_stage_task"
    elem_alternative_schema: "str"
  run_stage_task:
    type: "dict"
    props:
      name:
        type: "str"
        non_empty: true
      key:
        type: "str"
      node_task:
        type: "bool"
      pod_task:
        type: "bool"
      all_nodes:
        type: "bool"
      nodes:
        type: "list"
        elem_schema: "run_stage_task_node"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  run_stage_task_node:
    type: "simple_dict"
    alternative_type: "str"
    props:
      name:
        type: "str"
        non_empty: true
      all_pods:
        type: "bool"
      pods:
        type: "list"
        elem_type: "str"
  task:
    type: "dict"
    props:
      type:
        type: "str"
        non_empty: true
        choices: ["task", "shell", "skip"]
      target_origin:
        type: "str"
        choices: ["env", "cloud", "pod"]
      file:
        type: "str"
      cmd:
        type: "str"
      poll:
        type: "int"
      root:
        type: "bool"
      schema:
        type: "str"
      credentials:
        type: "map"
        elem_type: "str"
      contents:
        type: "map"
        elem_schema: "content"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  content:
    type: "simple_dict"
    alternative_type: "str"
    props:
      type:
        type: "str"
        choices: ["env", "str", "file", "template"]
      name:
        type: "str"
      key:
        type: "str"
      origin:
        type: "str"
        choices: ["env", "cloud", "custom"]
      file:
        type: "str"
      schema:
        type: "str"
      credentials:
        type: "map"
        elem_type: "str"
      contents:
        type: "map"
        elem_schema: "content"
      params:
        type: "dict"
      group_params:
        type: "map"
        elem_type: "str"
      shared_params:
        type: "list"
        elem_type: "str"
      shared_group_params:
        type: "str"
  repo:
    type: "dict"
    props:
      src:
        type: "str"
        non_empty: true
      version:
        type: "str"
      ssh_file:
        type: "str"
      ssh_file_encrypted:
        type: "bool"
  shared_group_params:
    type: "map"
    elem_type: "str"
